
<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RT69 Bingo</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getFirestore, collection, setDoc, doc, onSnapshot,
      serverTimestamp, deleteDoc, query, orderBy
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPROStzej4WQDlPNzvzzFpllBuR8-EctQ",
      authDomain: "rt69-bingo.firebaseapp.com",
      projectId: "rt69-bingo",
      storageBucket: "rt69-bingo.firebasestorage.app",
      messagingSenderId: "161894069210",
      appId: "1:161894069210:web:a81eb316a67d1c6d4bc6e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const isAdmin = window.location.search.includes("admin=true");

    const getName = () => document.getElementById("playerName").value.trim();

    async function updatePlayer() {
      const name = getName();
      if (!name) return;
      const marked = document.querySelectorAll('.cell.marked').length;
      await setDoc(doc(db, "players", name), {
        name,
        marked,
        timestamp: serverTimestamp()
      });
    }

    function watchPlayers() {
      const list = document.getElementById("players");
      onSnapshot(query(collection(db, "players"), orderBy("timestamp", "desc")), snap => {
        const shown = new Set();
        list.innerHTML = "";
        snap.forEach(doc => {
          const d = doc.data();
          if (!shown.has(d.name)) {
            const li = document.createElement("li");
            li.textContent = `ğŸ‘¤ ${d.name} (${d.marked} kryss)`;
            list.appendChild(li);
            shown.add(d.name);
          }
        });
      });
    }

    function watchWinners() {
      const list = document.getElementById("winners");
      onSnapshot(query(collection(db, "winners"), orderBy("timestamp", "desc")), snap => {
        list.innerHTML = "";
        snap.forEach(docSnap => {
          const d = docSnap.data();
          const li = document.createElement("li");
          li.textContent = `ğŸ† ${d.name} â€¢ ${new Date(d.timestamp?.seconds * 1000).toLocaleTimeString()}`;
          if (isAdmin) {
            const btn = document.createElement("button");
            btn.textContent = "âŒ";
            btn.onclick = () => deleteDoc(doc(db, "winners", docSnap.id));
            li.append(" ", btn);
          }
          list.appendChild(li);
        });
      });
    }

    async function declareWinner() {
      const name = getName();
      if (!name) return;
      await setDoc(doc(db, "winners", name + "-" + Date.now()), {
        name,
        timestamp: serverTimestamp()
      });
    }

    const bingoItems = [
  "NÃ¥gon sÃ¤ger 'det Ã¤r vÃ¤l egentligen sekreterarens jobb?'",
  "NÃ¥gon nÃ¤mner en fÃ¶rlorad klubbmedlem",
  "OrdfÃ¶randen sÃ¤ger 'det dÃ¤r tar vi sen'",
  "En spontant planerad aktivitet fÃ¶reslÃ¥s",
  "NÃ¥gon har glÃ¶mt sitt ansvarsomrÃ¥de",
  "Ett dÃ¥ligt fÃ¶rslag fÃ¥r starkt stÃ¶d",
  "Det refereras till fÃ¶rra Ã¥rets kaos",
  "SKÃ…L!",
  "â€˜Vi borde ha haft med Namn hÃ¤râ€™",
  "NÃ¥gon skÃ¤mtar om att vara bakis",
  "NÃ¥gon blir ofrivillig projektledare",
  "En allmÃ¤n suck hÃ¶rs",
  "En punkt gÃ¥r Ã¶ver tiden",
  "NÃ¥gon glÃ¶mmer vad vi pratar om",
  "En regel diskuteras men ingen kan den",
  "NÃ¥gon bÃ¶rjar googla under mÃ¶tet",
  "NÃ¥gon sÃ¤ger 'vi behÃ¶ver tÃ¤nka mer lÃ¥ngsiktigt'",
  "NÃ¥gon pratar om att klubben ska infÃ¶rskaffa en buss",
  "NÃ¥gon frÃ¥gar 'har vi budget fÃ¶r det?'",
  "Ett internt skÃ¤mt drar ut pÃ¥ tiden",
  "InternskÃ¤mt drar ut pÃ¥ tiden",
  "Dryck hÃ¤lls upp i fel glas",
  "NÃ¥gon nÃ¤mner tidigare ordfÃ¶rande",
  "Mobilen ringer mitt i mÃ¶tet",
  "KlubbnÃ¥len tappas bort",
  "FÃ¶reslÃ¥s att boka padel",
  "Citat frÃ¥n fÃ¶rra festen nÃ¤mns",
  "NÃ¥gon lÃ¤ser protokoll fel",
  "RT69 nÃ¤mns med stolthet",
  "Skratt utan att fÃ¶rklara varfÃ¶r",
  "NÃ¥gon fÃ¶reslÃ¥r bastuaktivitet",
  "MÃ¶tet spÃ¥rar ur till sidospÃ¥r",
  "NÃ¥gon fÃ¶reslÃ¥r ett nytt lotteri",
  "Planer pÃ¥ klubbresa diskuteras",
  "Alla glÃ¶mmer vilken punkt man Ã¤r pÃ¥",
  "MÃ¶tesledaren tappar kontrollen",
  "PowerPoint kraschar",
  "Diskussion om logotypen uppstÃ¥r",
  "Engelsk titel anvÃ¤nds i onÃ¶dan",
  "NÃ¥gon nÃ¤mner LC",
  "NÃ¥gon Ã¤r osÃ¤ker pÃ¥ om de ska delta pÃ¥ ett RT-event utanfÃ¶r klubben",
  "Vegas nÃ¤mns",
  "En post member deltar pÃ¥ mÃ¶tet",
  "En gÃ¤st deltar pÃ¥ mÃ¶tet",
  "NÃ¥gon lÃ¤gger till en Ã¶vrig frÃ¥ga eller pÃ¥stÃ¥ende lÃ¶pande",
  "NÃ¥gon tar en ogiltig KP",
  "Klubbis misskÃ¶ter sig",
  "Broder kommer inte till tals",
  "FÃ¶rslag om samverkan med annan klubb dyker upp",
  "NÃ¥gon har fÃ¶r gammal RT-trÃ¶ja pÃ¥ sig",
  "MÃ¶tet glider Ã¶ver till nostalgisnack",
  "NÃ¥gon visar bilder frÃ¥n en resa",
  "Fel bilaga anvÃ¤nds i diskussion",
  "Ska vi byta dag fÃ¶r mÃ¶ten? fÃ¶reslÃ¥s",
  "Ingen vet vem som ansvarar fÃ¶r aktiviteten",
  "OrdfÃ¶rande nÃ¤mner budget trots att det inte gÃ¤ller",
  "Alla bÃ¶rjar snacka samtidigt",
  "MÃ¶tet avslutas utan att det mÃ¤rks"
];

    function buildBoard() {
      const name = getName();
      if (!name) return alert("â— Skriv ditt namn fÃ¶rst!");

      const board = document.getElementById("board");
      board.innerHTML = "";
      const shuffled = [...bingoItems].sort(() => 0.5 - Math.random()).slice(0, 24);
      let i = 0;
      for (let r = 0; r < 5; r++) {
        for (let c = 0; c < 5; c++) {
          const div = document.createElement("div");
          div.className = "cell";
          if (r === 2 && c === 2) {
            div.textContent = "GRATIS";
            div.classList.add("marked", "free");
          } else {
            div.textContent = shuffled[i++];
            div.onclick = () => {
              div.classList.toggle("marked");
              updatePlayer();
            };
          }
          board.appendChild(div);
        }
      }
      updatePlayer();
    }

    function checkBingo() {
      const name = getName();
      if (!name) return alert("â— Skriv ditt namn fÃ¶rst!");

      const cells = document.querySelectorAll(".cell");
      const grid = Array.from({ length: 5 }, (_, r) =>
        Array.from({ length: 5 }, (_, c) => cells[r * 5 + c].classList.contains("marked"))
      );
      const bingo = grid.some(row => row.every(Boolean)) ||
        grid[0].map((_, i) => grid.every(row => row[i])).some(Boolean) ||
        grid.every((row, i) => row[i]) ||
        grid.every((row, i) => row[4 - i]);
      if (bingo) {
        confetti();
        document.getElementById("bingoSound").play();
        alert("ğŸ‰ BINGO! Spelet pausas. Vinnaren ska visa sin rad och fÃ¥ den godkÃ¤nd av bingomÃ¤staren.");
        declareWinner();
      } else {
        alert("âŒ Ingen giltig rad Ã¤nnu!");
      }
    }

    window.onload = () => {
      watchPlayers();
      watchWinners();
    }
  </script>
  <style>
    body { font-family:sans-serif; background:#002d72; color:white; text-align:center; }
    .board { display:grid; grid-template-columns:repeat(5,1fr); gap:10px; max-width:600px; margin:20px auto; }
    .cell { background:white; color:#002d72; padding:10px; border-radius:6px; cursor:pointer; }
    .cell.marked { background:#ffc72c; text-decoration: line-through; }
    .cell.free { background:#ccc; cursor:default; }
    input { padding:10px; margin:10px; width:250px; }
    button { padding:10px 20px; margin:10px; border:none; background:#ffc72c; cursor:pointer; }
    .section { margin:30px auto; max-width:800px; background:#001b3d; padding:15px; border-radius:10px; }
    h2 { color:#ffc72c; }
    ul { list-style:none; padding:0; }
    li button { margin-left:10px; }
  </style>
</head>
<body>
  <h1>ğŸ¯ RT69 Bingo</h1>
  <input id="playerName" placeholder="Ditt namn" oninput="updatePlayer()" />
  <div class="board" id="board"><div style="grid-column: span 5; color: gray;">Tryck pÃ¥ "Ny bricka" fÃ¶r att bÃ¶rja spela</div></div>
  <button onclick="buildBoard()">ğŸ†• Ny bricka</button>
  <button onclick="checkBingo()">âœ… BINGO!</button>

  <div class="section">
    <h2>ğŸ‘‘ Vinnare</h2>
    <ul id="winners"></ul>
  </div>

  <div class="section">
    <h2>ğŸ‘¥ Aktiva spelare</h2>
    <ul id="players"></ul>
  </div>

  <div class="section">
    <h2>ğŸ“œ Regler fÃ¶r RT69 Bingo</h2>
    <ul>
      <li>âœ”ï¸ Kryssa en ruta â€“ drick valfri dryck ğŸ»</li>
      <li>âœ”ï¸ BINGO = hel rad (vÃ¥grÃ¤tt, lodrÃ¤tt eller diagonalt)</li>
      <li>âœ”ï¸ Tryck pÃ¥ BINGO-knappen</li>
      <li>âœ”ï¸ Spelet pausas och vinnaren fÃ¶rklarar sin rad</li>
      <li>âœ”ï¸ BingomÃ¤staren validerar raden och delar ut pris ğŸ†</li>
    </ul>
  </div>

  <audio id="bingoSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
</body>
</html>
